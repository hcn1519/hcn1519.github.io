<!DOCTYPE html>
<html>

  <head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5VLL8HQ');</script>
  <!-- End Google Tag Manager -->
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-5VL9R6T5ZN"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-5VL9R6T5ZN');
  </script>

  <!-- encoding -->
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, viewport-fit=cover">

  <!-- Primary Meta Tags -->
  <title>atomic/non atomic - hcn1519 DEV</title>
  <meta name="author" content="Changnam Hong">
  <meta name="title" content="atomic/non atomic - hcn1519 DEV">
  <meta name="description" content="Exploring the concept of 'atomic.'">
  <meta name="theme-color" content="#f1f3f4" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="atomic/non atomic">
  <meta property="og:image" content="/en/public/assets/swiftLogo.jpg">
  <meta property="og:description" content="Exploring the concept of 'atomic.'">

  <!-- CSS -->
  <link rel="stylesheet" href="/en/public/sass/blogTheme.scss.css" async>
  <link rel="stylesheet" href="/en/public/sass/menu.scss.css" async>
  <link rel="stylesheet" href="/en/public/sass/syntax.scss.css" async>
  <!-- Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <!-- <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"> -->
  <!-- <meta name="msapplication-TileColor" content="#da532c"> -->
  <!-- Fonts -->
  <link rel="preload" href="/en/public/fonts/Age-Normal.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/en/public/fonts/Mona-Sans-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="/en/public/fonts/Mona-Sans-SemiBold.woff2" as="font" type="font/woff2" crossorigin>
  <link type="application/atom+xml" rel="alternate" href="https://hcn1519.github.io/en/feed.xml" title="hcn1519 DEV" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml" async>

</head>


  <body>
      <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5VLL8HQ"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="wrap">
      <nav class="menu">
  <div class="menu-container">
    <ul class="menu-list">
      <li class="menu-item">
        <a class="menu-link" href="/en/">Home</a>
      </li>

      
      
        
          
        
      
        
          
        
      
        
          
            <li class="menu-item">
              <a class="menu-link" href="/en/about">About</a>
            </li>
          
        
      
        
          
            <li class="menu-item">
              <a class="menu-link" href="/en/archives/">Archives</a>
            </li>
          
        
      
        
      
        
      
        
          
        
      
        
      
        
      
        
          
            <li class="menu-item">
              <a class="menu-link" href="/en/tags/">Tags</a>
            </li>
          
        
      
    </ul>
  </div>

  <a class="menu-toggle">
    <div class="menu-hamburger"></div>
  </a>
</nav>

      <aside class="side-menu-in-desktop">
        <ul class="menu-list">
  <li class="menu-item">
    <a class="menu-link" href="/en/">Home</a>
  </li>

  
  
    
      
    
  
    
      
    
  
    
      
        <li class="menu-item">
          <a class="menu-link" href="/en/about">About</a>
        </li>
      
    
  
    
      
        <li class="menu-item">
          <a class="menu-link" href="/en/archives/">Archives</a>
        </li>
      
    
  
    
  
    
  
    
      
    
  
    
  
    
  
    
      
        <li class="menu-item">
          <a class="menu-link" href="/en/tags/">Tags</a>
        </li>
      
    
  
</ul>
      </aside>
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/en" title="Home">HCN</a>
            <span>DEV</span>
            <span class="translation">
              <small>
              
              <a href="/">한국어로 보기</a>
              
              </small>
            </span>
          </h3>
        </div>
      </div>
      
      <div class="container content">
        <div class="post">
  <h2 class="post-title">atomic/non atomic</h2>
  <span class="post-date">01 Mar 2019</span>
  
  <div class="post-image-feature">
    <img class="feature-image" src=
    
    "/en/public/assets/swiftLogo.jpg"
    
    alt="atomic/non atomic feature image">

    
  </div><!-- /.image-wrap -->
  

  

  

  
  

        
  
  
  <p>The concept of <code class="language-plaintext highlighter-rouge">atomic</code> is familiar to those who have experience with Objective-C but may be unfamiliar to those who have only used Swift. Let’s examine the definition of <code class="language-plaintext highlighter-rouge">atomic</code>:</p>

<ul>
  <li>atomic - Not interrupted</li>
</ul>

<blockquote>
  <p>an operation appears to occur at a single instant between its invocation and its response</p>
</blockquote>

<p>Being <code class="language-plaintext highlighter-rouge">atomic</code> in programming means making changes to data appear as if they happened all at once. Changing the value of data always takes some time. However, <code class="language-plaintext highlighter-rouge">atomic</code> data gives the perception to multiple data consumers (processes, threads, etc.) that the time it takes to change the data’s value is zero. How is this possible? In Objective-C, when you set <code class="language-plaintext highlighter-rouge">atomic</code> data, it locks it to make it atomic.</p>

<div class="language-objective_c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">atomic</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">oldValue</span> <span class="o">=</span> <span class="o">*</span><span class="n">slot</span><span class="p">;</span>
    <span class="o">*</span><span class="n">slot</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">spin_lock_t</span> <span class="o">*</span><span class="n">slotlock</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PropertyLocks</span><span class="p">[</span><span class="n">GOODHASH</span><span class="p">(</span><span class="n">slot</span><span class="p">)];</span>
    <span class="n">_spin_lock</span><span class="p">(</span><span class="n">slotlock</span><span class="p">);</span>
    <span class="n">oldValue</span> <span class="o">=</span> <span class="o">*</span><span class="n">slot</span><span class="p">;</span>
    <span class="o">*</span><span class="n">slot</span> <span class="o">=</span> <span class="n">newValue</span><span class="p">;</span>
    <span class="n">_spin_unlock</span><span class="p">(</span><span class="n">slotlock</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Locking a thread means that everything other than the data change operation stops when changing the data (more precisely, when a SpinLock is used, the thread enters a loop and busy waits until all operations in the critical section are completed). So, in other words, it makes it seem like the data changed instantly without any time-consuming operations because nothing else happened except for updating the data. In this way, <code class="language-plaintext highlighter-rouge">atomic</code> data guarantees that in a multi-threaded environment, data can only be accessed in the situation before and after the change. That is, during the data change, access to that data is not possible (because it’s locked).</p>

<ul>
  <li>For a more detailed explanation of locks, you can refer to <a href="http://www.vadimbulavin.com/atomic-properties/">Atomic Properties in Swift</a>.</li>
</ul>

<h3 id="atomic-and-objective-c">atomic and Objective-C</h3>

<p>In Objective-C, properties are declared as <code class="language-plaintext highlighter-rouge">atomic</code> by default. However, <code class="language-plaintext highlighter-rouge">atomic</code> properties, as seen earlier, slow down property access because they lock the <code class="language-plaintext highlighter-rouge">atomic</code> data during access. Therefore, for many Objective-C properties that should only be updated on the main thread (such as View Properties), it’s advisable to set the <code class="language-plaintext highlighter-rouge">nonatomic</code> annotation.</p>

<div class="language-objective_c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">@interface</span> <span class="nc">Asset</span> <span class="p">:</span> <span class="nc">NSObject</span>
<span class="c1">// Use 'nonatomic' for the 'name' property.</span>
<span class="k">@property</span> <span class="p">(</span><span class="n">nonatomic</span><span class="p">,</span> <span class="n">strong</span><span class="p">)</span> <span class="n">NSString</span> <span class="o">*</span><span class="n">name</span><span class="p">;</span>
<span class="k">@end</span>
</code></pre></div></div>

<h3 id="atomic-and-swift">atomic and Swift</h3>

<p>On the other hand, Swift is not a language designed with thread-safety in mind, so all properties in Swift are <code class="language-plaintext highlighter-rouge">non atomic</code> by default. Additionally, you cannot specify the <code class="language-plaintext highlighter-rouge">atomic</code> option separately in Swift. Therefore, to make Swift properties support <code class="language-plaintext highlighter-rouge">atomic</code>, you need to implement it using GCD (Grand Central Dispatch). You can find more details in the following <a href="https://www.objc.io/blog/2018/12/18/atomic-variables/">article</a>. Here, we’ll provide a simple example based on the article.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">AtomicValue</span><span class="o">&lt;</span><span class="kt">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">queue</span> <span class="o">=</span> <span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"queue"</span><span class="p">)</span>

    <span class="kd">private(set)</span> <span class="k">var</span> <span class="nv">storedValue</span><span class="p">:</span> <span class="kt">T</span>

    <span class="nf">init</span><span class="p">(</span><span class="n">_</span> <span class="nv">storedValue</span><span class="p">:</span> <span class="kt">T</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">storedValue</span> <span class="o">=</span> <span class="n">storedValue</span>
    <span class="p">}</span>

    <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">T</span> <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">queue</span><span class="o">.</span><span class="n">sync</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">storedValue</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">set</span> <span class="p">{</span> <span class="c1">// Reading and writing access is atomic by itself,</span>
              <span class="c1">// but access is possible by other threads during data change (between read and write), so it's not perfectly atomic.</span>
            <span class="n">queue</span><span class="o">.</span><span class="n">sync</span> <span class="p">{</span>
                <span class="k">self</span><span class="o">.</span><span class="n">storedValue</span> <span class="o">=</span> <span class="n">newValue</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// The correct way</span>
    <span class="kd">func</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">_</span> <span class="nv">transform</span><span class="p">:</span> <span class="p">(</span><span class="k">inout</span> <span class="kt">T</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">())</span> <span class="p">{</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">sync</span> <span class="p">{</span>
            <span class="nf">transform</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="o">.</span><span class="n">storedValue</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">atomicInComplete</span> <span class="o">=</span> <span class="kt">AtomicValue</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">atomicComplete</span> <span class="o">=</span> <span class="kt">AtomicValue</span><span class="o">&lt;</span><span class="kt">Int</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="kt">DispatchQueue</span><span class="o">.</span><span class="nf">concurrentPerform</span><span class="p">(</span><span class="nv">iterations</span><span class="p">:</span> <span class="mi">100</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">in</span>

    <span class="n">atomicInComplete</span><span class="o">.</span><span class="n">value</span> <span class="o">+=</span> <span class="n">idx</span>

    <span class="n">atomicComplete</span><span class="o">.</span><span class="n">mutate</span> <span class="p">{</span> <span class="nv">$0</span> <span class="o">+=</span> <span class="n">idx</span> <span class="p">}</span>
<span class="p">}</span>

<span class="nf">print</span><span class="p">(</span><span class="n">atomicInComplete</span><span class="o">.</span><span class="n">storedValue</span><span class="p">)</span> <span class="c1">// Result: Varies each time it's run</span>
<span class="nf">print</span><span class="p">(</span><span class="n">atomicComplete</span><span class="o">.</span><span class="n">storedValue</span><span class="p">)</span> <span class="c1">// Result: 4950</span>
</code></pre></div></div>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&amp;ejkGb=KOR&amp;barcode=9788994506401">Objective-C Programming by Aaron Hillegass</a></li>
  <li><a href="https://medium.com/@YogevSitton/atomic-vs-non-atomic-properties-crash-course-d11c23f4366c">Atomic vs. Non Atomic Properties Crash Course</a></li>
  <li><a href="https://www.objc.io/blog/2018/12/18/atomic-variables/">Swift Tips: Atomic Variables</a></li>
</ul>


<div class="related">
  
  
  
  
  
  

  

    
    

    

    

  

    
    

    

    
      
        
        <h2>What to Read More</h2>
        
      <ul class="related-posts">
      
        <li>
          <h3>
            <a href="/en/articles/2022-04/swift_async_await">
              Swift Async Await
              <small>08 Apr 2022</small>
            </a>
            <small> 
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#Swift">
                Swift
              </a>
            </div>
           
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#Language">
                Language
              </a>
            </div>
          </small>
          </h3>
        </li>
      </li>
      
      
    

  

    
    

    

    

  

    
    

    

    

  

    
    

    

    

  

    
    

    

    

  

    
    

    

    

  

    
    

    

    

  

    
    

    

    

  

    
    

    

    
      
        <li>
          <h3>
            <a href="/en/articles/2019-03/thread-safe">
              Thread Safe
              <small>21 Mar 2019</small>
            </a>
            <small> 
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#Swift">
                Swift
              </a>
            </div>
           
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#atomic">
                atomic
              </a>
            </div>
           
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#OS">
                OS
              </a>
            </div>
          </small>
          </h3>
        </li>
      </li>
      
      
    

  

    
    

    

    

  

    
    

    

    
      
        <li>
          <h3>
            <a href="/en/articles/2017-09/swift_escaping_closure">
              Understanding Escaping Closures in Swift
              <small>12 Sep 2017</small>
            </a>
            <small> 
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#Swift">
                Swift
              </a>
            </div>
           
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#Language">
                Language
              </a>
            </div>
          </small>
          </h3>
        </li>
      </li>
      
      
    

  

    
    

    

    

  

    
    

    

    
      
        <li>
          <h3>
            <a href="/en/articles/2017-07/swift_Str">
              Working with Swift Strings
              <small>09 Jul 2017</small>
            </a>
            <small> 
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#Swift">
                Swift
              </a>
            </div>
           
            <div class="tag-chips">
              <a class="tag-link" href="/en/tags/#Language">
                Language
              </a>
            </div>
          </small>
          </h3>
        </li>
      </li>
      
      
        
  </ul>

  
</div>


<script>
  
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    // dark mode
    
  }
</script>
<script src="https://utteranc.es/client.js"
        repo="hcn1519/hcn1519.github.io"
        issue-term="og:title"
        label="gets Comments 🙌"
        theme=github-dark
        crossorigin="anonymous"
        async>
</script>
<div class="back-home">
    <a href="/en">< Home</a>
  </div>
</div>
      </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="/en/public/js/sidebarHamburger.js"></script>
  </body>
</html>
